@Styles.Render("~/Content/css-application")
@model Site.ViewModels.RadiosViewModel
@{
    Layout = null;
}
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Rádio CompanyName - A Rádio de Minas " />
<meta name="description" content="" />
<meta name="resource-type" content="document" />
<meta name="content-language" content="pt-br" />
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<style>
    .ouca-ao-vivo {
        font-size: 22px;
        text-transform: uppercase;
        position: absolute;
        left: 65px;
        line-height: 42px;
        font-style: italic;
    }

    .play-button {
        position: absolute;
        top: 50%;
        left: 50%;
        height: 75px;
        width: 75px;
        color: white;
        border-radius: 20px;
        background-color: #cccccc;
        -webkit-transform: translate(-50%, -50%);
        -moz-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        -o-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        cursor: pointer;
    }

        .play-button i {
            font-size: 40px;
            position: absolute;
            top: 50%;
            left: 50%;
            color: #ad1111;
            -webkit-transform: translate(-50%, -50%);
            -moz-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            -o-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
        }

    .audio-range {
        margin-left: 620px;
        vertical-align: middle;
        margin-top: -31px;
    }

    .texto-programa {
        float: right;
        font-size: 20px;
        margin-right: 30px;
        font-weight: bold;
        vertical-align: middle;
        margin-top: -29px;
    }

    @@media (max-width: 1024px) {
        .choice-station {
            margin-left: 70px;
        }

        .audio-range {
            margin-left: 560px;
        }

        .main-header .top-bar .info-timer {
            display: none;
        }
    }

    @@media (max-width: 768px) {
        .texto-programa {
            float: right;
            font-size: 1.2em;
            margin-right: 0px;
            margin-top: -23px;
            font-weight: bold;
            vertical-align: middle;
        }

        .audio-range {
            margin-left: 400px;
            margin-top: -8px;
        }

        .play-button {
            height: 50px;
            width: 50px;
        }

            .play-button i {
                font-size: 20px;
            }

        .choice-station {
            right: 498px;
            bottom: -9px;
        }

        .ouca-ao-vivo {
            font-size: 1.2em;
            left: 65px;
            line-height: 26px;
        }

        #header-2017 {
            padding-top: 50px !important;
            top: -25px;
            position: relative;
        }

        .choice-station .stations {
            top: 100%;
            bottom: auto;
        }

        .submenu {
            top: 100%;
        }

        .fa-spinner .fa-pulse {
            top: 29%;
            left: 23%;
        }
    }

    @@media (max-width: 425px) {
        .main-header .top-bar .link {
            display: none;
        }

        .audio-range, .img-live, .texto-programa {
            display: none;
        }

        .play-button {
            left: 9%;
        }

        .choice-station {
            right: 9px;
            bottom: -20px;
        }

        .main-header .medium-bar {
            padding: 30px 0;
        }

        .ouca-ao-vivo {
            font-size: 1.5em;
            left: 85px;
            line-height: 5px;
        }

        .fa-spinner .fa-pulse {
            top: 29%;
            left: 23%;
        }
    }

    @@media (max-width: 425px) {
        .ouca-ao-vivo {
            left: 69px;
        }
    }

    @@media (max-width: 320px) {
        .ouca-ao-vivo {
            left: 61px;
        }
    }

    #volume {
        color: #ad1111;
        cursor: pointer;
    }

    #audio-range {
        outline: none;
        height: 6px;
        background-color: #cccccc;
        background-image: -webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, #ad1111), color-stop(100%, #ad1111));
        background-image: -webkit-linear-gradient(#ad1111, #ad1111);
        background-image: -moz-linear-gradient(#ad1111, #ad1111);
        background-image: -o-linear-gradient(#ad1111, #ad1111);
        background-image: linear-gradient(#ad1111, #ad1111);
        background-size: 50% 100%;
        background-repeat: no-repeat;
        border-radius: 10px;
        cursor: pointer;
        -webkit-appearance: none;
    }

        #audio-range::-webkit-slider-runnable-track {
            box-shadow: none;
            border: none;
            background: transparent;
            -webkit-appearance: none;
        }

        #audio-range::-moz-range-track {
            box-shadow: none;
            border: none;
            background: transparent;
        }

        #audio-range::-moz-focus-outer {
            border: 0;
        }

        #audio-range::-webkit-slider-thumb {
            width: 14px;
            height: 14px;
            border: 0;
            background: #fff;
            border-radius: 100%;
            box-shadow: 0 0 1px 0px rgba(0,0,0,0.1);
            -webkit-appearance: none;
        }

        #audio-range::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border: 0;
            background: #fff;
            border-radius: 100%;
            box-shadow: 0 0 1px 0px rgba(0,0,0,0.1);
        }

    .choice-station .stations .rdoLink {
        display: block;
        padding: 15px 15px;
        font-size: 13px;
        font-weight: bold;
        color: black;
        position: relative;
        -webkit-transition: background 0.2s ease;
        transition: background 0.2s ease;
    }

        .choice-station .stations .rdoLink:hover {
            background: #640000;
            color: white;
        }

    .lds-spinner {
        position: relative;
    }

    .fa-pulse {
        top: 22% !important;
        left: 16% !important;
    }
</style>



<div class="main-header">
    <div class="top-bar">
        <div class="center" style="height: 40px">
            <a href="#" class="main-logo">
                <img src="~/images/Logo_CompanyName_Radio_Branco.png" alt="CompanyName 610 am - 95,7 fm" class="logo-1">
                <img src="~/images/logo-b.png" alt="CompanyName 610 am - 95,7 fm" class="logo-2">
            </a>
        </div>
    </div>
    <div class="medium-bar">
        <div class="center clearfix">
            <img src="../images/radio-live.gif" style="vertical-align: middle;" class="img-live" />
            <b class="ouca-ao-vivo">ou&ccedil;a ao vivo</b>
            <div class="choice-station">
                <header class="title">
                    <b id="selectedRadio">OU&Ccedil;A AGORA</b>
                </header>
                <nav class="stations">
                    @if (ViewBag.radios != null && ViewBag.radios.Count > 0)
                    {
                        <ul id="radioList">
                            @foreach (var item in ViewBag.radios)
                            {
                                <li class="rdoLink" id="@item.Chave"><b></b>@item.Titulo</li>
                            }
                        </ul>
                    }
                </nav>
            </div>
            <audio id="player" controls name="media" controlsList="nodownload" style="display:none">
                <source id="source1" src="@Model.Stream1" type="audio/@( Model.Stream1.EndsWith(".aac") ? "aac" : "mpeg" )" class="audio-mobile">
                <source id="source2" src="@Model.Stream2" type="audio/@( Model.Stream2.EndsWith(".aac") ? "aac" : "mpeg" )" class="audio-mobile">
            </audio>
            <div class="lds-css ng-scope">
                <div class="lds-spinner" style="width:100%;height:100%"></div>
            </div>
            <div id="play-button" class="play-button" onclick="playMusic()">
                <i class="fa"></i>
            </div>

            <div class="audio-range">
                <input type="range" id="audio-range" class="audio-range2" min="0" max="1" step="0.01">
                <i id="volume" class="fa" style="font-size: 22px;" onclick="muteButton()"></i>
            </div>

            <div class="texto-programa">
                <div id="idProgramacao" style="display:none;"></div>
                <div id="nomeProgramacao"></div>
                <div id="horarioProgramacao"></div>

                <input type="hidden" id="inicioProgramacao" value="" />
                <input type="hidden" id="fimProgramacao" value="" />
            </div>


        </div>

    </div>
</div>
<script src="https://use.fontawesome.com/ac367eb9dd.js"></script>
<script type="text/javascript">

    $(document).ready(function () {

        ///////////////////// Início - Programação do Player /////////////////////

        //Executa a função para exibir os dados da programação ao carregar a página
        atualizaProgramacao();
        //Roda de 1 em 1 minuto no client side verificando o horário
        setInterval(verificaHorario, 60000);

        //Função para atualizar a programação do Player
        function atualizaProgramacao() {
            $.ajax({
                type: "GET",
                url: "http://localhost/Home/ProgramacaoRadioMenu",

                success: function (data) {

                    $.each(data, function (k, v) {
                        $('#idProgramacao').html(v[0]['Id']);
                        $('#nomeProgramacao').html(v[0]['Nome']);
                        $('#horarioProgramacao').html(v[0]['Horario'] + ' - ' + v[0]['FimHorario']);

                        $('#inicioProgramacao').prop('value', v[0]['Horario']);
                        $('#fimProgramacao').prop('value', v[0]['FimHorario']);
                    });
                }
            });
        }

        //Função para verificar o horário da programação
        function verificaHorario() {
            var timeStamp = Date.parse("@System.DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")");
            var horarioServidor = new Date(timeStamp);

            var diaAtual = @System.DateTime.Now.Day;
            var mesAtual = @System.DateTime.Now.Month;
            var anoAtual = @System.DateTime.Now.Year;
            var inicioProgramacaoAtual = new Date(Date.parse(anoAtual + '-' + mesAtual + '-' + diaAtual + ' ' + $('#inicioProgramacao').val() + ':00'));
            var fimProgramacaoAtual = new Date(Date.parse(anoAtual + '-' + mesAtual + '-' + diaAtual + ' ' + $('#fimProgramacao').val() + ':00'));

            if (fimProgramacaoAtual <= horarioServidor)
            {
                atualizaProgramacao();
            }
        }
        ///////////////////// Fim - Programação do Player /////////////////////

        var nomeRadio = $('#' + localStorage.radioId).html();
        $('#selectedRadio').html(nomeRadio);

        var convertAudio = parseFloat(localStorage.volume / 100);
        $('#audio-range').attr('style', 'background-size:' + localStorage.volume + '% 100%');
        $('#audio-range').val(convertAudio);

        if (localStorage.status == 1) {
            $('#play-button i').toggleClass('fa-pause');
        } else {
            $('#play-button i').toggleClass('fa-play');
        }

        if (localStorage.status == 1) {
            $('#player').trigger('play');
        } else {
            $('#player').trigger('pause');
        }

        if (localStorage.mute == 0) {
            $('#volume').addClass('fa-volume-up').removeClass('fa-volume-off');
            $('#player').prop('muted', false);
        } else {
            $('#volume').removeClass('fa-volume-up').addClass('fa-volume-off');
            $('#player').prop('muted', true);
        }


        var audio = $('#player');
        var playButton = $('#play-button');
        var volumeButton = $('#volume');
        var sliderAudio = $('#audio-range');


        sliderAudio.on('input', function () {

            localStorage.setItem('mute', '0');
            $('#volume').addClass('fa-volume-up').removeClass('fa-volume-off');
            $('#player').prop('muted', false);

            $('#player')[0].volume = this.value;
            console.log($('#player')[0].volume * 100);
            porcentagem = $('#player')[0].volume * 100;
            localStorage.setItem('volume', porcentagem);
            $('#audio-range').attr('style', 'background-size:' + porcentagem + '% 100%');
            if ($('#player')[0].volume == 0) {
                localStorage.setItem('mudo', '1');
                volumeButton.removeClass('fa fa-volume-up').addClass('fa fa-volume-off');
            }
            else {
                localStorage.setItem('mudo', '0');
                volumeButton.removeClass('fa fa-volume-off').addClass('fa fa-volume-up');
            }
        });

        $('#radioList li').on("click", function () {
            var radio = $(this);
            if (radio !== undefined && radio != null && radio[0] !== null && radio[0] !== undefined) {
                $('#selectedRadio').text(radio.text());
                $.ajax({
                    url: "@Url.Action("RadioJsonAsync", "Home")?chave=" + radio[0].id,
            type: "GET",
            success: function (data) {
                        console.log(data.data);
                        console.log(data.data.Stream1);
                        $('#source1').attr('src', data.data.Stream1);
                        $('#source2').attr('src', data.data.Stream2);
                        $('#source1').attr('type', data.data.Stream1.endsWith(".aac") ? "audio/aac" : "audio/mpeg");
                        $('#source2').attr('type', data.data.Stream2.endsWith(".aac") ? "audio/aac" : "audio/mpeg");

                        //console.log($('#source1'));
                        //console.log($('#source1'));
                        //console.log(audio);

                        window.history.pushState('', 'Rádio CompanyName', '/Home/Player?chave=' + radio[0].id);
                        audio[0].load();
                        audio[0].play();
                        localStorage.setItem('radioId', radio[0].id);
                        //if (localStorage.abrirPopup == 0) {
                        //    playMusic(radio[0].id);
                        //}
                    }
                });
            }
        });
    });

    function playMusic() {

        $('#play-button i').toggleClass('fa-play');
        $('#play-button i').toggleClass('fa-pause');

        if (localStorage.status == 0) {
            localStorage.setItem('status', '1');
        } else {
            localStorage.setItem('status', '0');
        }

        if (localStorage.status == 1) {
            $('#player').trigger('play');
        } else {
            $('#player').trigger('pause');
        }
    }

    function muteButton() {
        if (localStorage.mute == 0) {
            localStorage.setItem('mute', '1');
            $('#volume').removeClass('fa-volume-up').addClass('fa-volume-off');
            $('#player').prop('muted', true);
        } else {
            localStorage.setItem('mute', '0');
            $('#volume').addClass('fa-volume-up').removeClass('fa-volume-off');
            $('#player').prop('muted', false);
        }
    }

    window.addEventListener('storage', function (e) {

        console.log(e);

        if (e.key == 'status') {
            $('#play-button i').toggleClass('fa-play');
            $('#play-button i').toggleClass('fa-pause');
        }

        if (e.key == 'volume') {
            $('#player').prop('muted', false);
            $('#audio-range').val(e.newValue / 100);
            $('#player')[0].volume = e.newValue / 100;
            $('#audio-range').attr('style', 'background-size:' + e.newValue + '% 100%');

            if (e.newValue == 0) {
                $('#volume').removeClass('fa-volume-up').addClass('fa-volume-off');
            } else {
                $('#volume').addClass('fa-volume-up').removeClass('fa-volume-off');
            }
        }

        if (e.key == 'mute') {
            if (e.newValue == 0) {
                $('#volume').addClass('fa-volume-up').removeClass('fa-volume-off');
                $('#player').prop('muted', false);
            } else {
                $('#volume').removeClass('fa-volume-up').addClass('fa-volume-off');
                $('#player').prop('muted', true);

            }
        }

        if (e.key == 'radioId') {
            var audio = $('#player');
            $.ajax({
                url: "@Url.Action("RadioJsonAsync", "Home")?chave=" + localStorage.radioId,
                type: "GET",
                success: function (data) {
                        console.log(data.data);
                        console.log(data.data.Stream1);
                        $('#source1').attr('src', data.data.Stream1);
                        $('#source2').attr('src', data.data.Stream2);
                        $('#source1').attr('type', data.data.Stream1.endsWith(".aac") ? "audio/aac" : "audio/mpeg");
                        $('#source2').attr('type', data.data.Stream2.endsWith(".aac") ? "audio/aac" : "audio/mpeg");

                        //console.log($('#source1'));
                        //console.log($('#source1'));
                        console.log(audio);

                        window.history.pushState('', 'Rádio CompanyName', '/Home/Player?chave=' + localStorage.radioId);
                        audio[0].load();
                        audio[0].play();
                        $('#selectedRadio').text(data.data.Titulo);
                        localStorage.setItem('radioId', radio[0].id);
                        //playMusic(localStorage.radioId);
                    }
                });
        }

        if (localStorage.status == 1) {
            $('#player').trigger('play');
        } else {
            $('#player').trigger('pause');
        }
    });

    var win = window.self;
    win.onbeforeunload = function () {

        localStorage.setItem('abrirPopup', '0');
        localStorage.setItem('status', '0');

        if (localStorage.abrirPopup == 0) {
            $('#botaoPlayPausePopup i').toggleClass('fa-play');
            $('#botaoPlayPausePopup i').toggleClass('fa-pause');
        }
    }

    $(document).on('input', '#audio-range', function () {
        localStorage.setItem('volume', $(this).val()*100);
    });
</script>




@*@if (Model != null)
    {
    <header>
        <div class="logo"></div>
        <h3>Streaming R&aacute;dio CompanyName - @Model.Titulo <a href="#" onclick="window.close();" class="btn-voltar">VOLTAR</a></h3>
    </header>

       <audio controls autoplay style="width: 300px; display: block; margin-left: 10px;">
            <source src="@Model.Stream1" type="audio/@( Model.Stream1.EndsWith(".aac") ? "aac" : "mpeg" )" class="audio-mobile">
            <source src="@Model.Stream2" type="audio/@( Model.Stream2.EndsWith(".aac") ? "aac" : "mpeg" )" class="audio-mobile">
            Your browser does not support the audio element.
        </audio>
    }
    @if (Model.Chave == "belo-horizonte")
    {
        <script src="https://cdn.mobradio.com.br/mr-analytics/vendor/md5.min.js"></script>
        <script src="https://cdn.mobradio.com.br/mr-analytics/vendor/jquery-1.12.4.js"></script>
        <script src="https://cdn.mobradio.com.br/mr-analytics/CompanyName/mr-analytics.min.js"></script>
    }
*@
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-12157365-1', 'auto');
    ga('send', 'pageview');
</script>